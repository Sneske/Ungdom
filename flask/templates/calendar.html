{% extends 'base.html' %}

{% block content %}
<div id='calendar'></div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
        editable: true,  // Enable draggable events
        eventDrop: function(info) {
            // Function to be called when an event is dropped to a new date
            fetch("{{ url_for('update_event') }}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    id: info.event.id,
                    start: info.event.start.toISOString(),
                    end: (info.event.end ? info.event.end.toISOString() : info.event.start.toISOString())
                })
            }).then(response => {
                if (!response.ok) {
                    alert('Error updating event');
                }
            });
        },
        initialView: 'dayGridMonth',
        events: {{ events | tojson }}
    });
    calendar.render();
});
</script>
{% endblock %}